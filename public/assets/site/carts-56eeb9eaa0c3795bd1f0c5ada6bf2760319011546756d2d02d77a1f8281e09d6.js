$(document).ready(function(){if(null!=document.getElementById("zipcode").innerHTML){getCep(document.getElementById("zipcode").innerHTML,{pac:"PAC",sedex:"SEDEX"});var e=0;$(".total-price").each(function(){var t=$(this).text(),t=t.replace("R$","").replace(",",".");isNaN(t)||0==t.length||(e+=parseFloat(t))});var t=e.toFixed(2);document.getElementById("total-cart").innerHTML="Total: R$"+e.toFixed(2).replace(".",","),$(".product-refresh").click(function(){var e=$(this).closest("tr").find(".pid").text(),t=$(this).closest("tr").find(".p-qty").find("#p_quantity").val();$.ajax({url:"/carrinho/"+e,type:"post",dataType:"json",data:{cart:{quantity:t}}}).done(function(){location.reload()}).fail(function(){console.log("error")})}),$("#save-order").click(function(){var e=gon.address.field1,a=gon.address.field2,n=gon.address.field3,o=gon.address.field4,r=gon.address.city,i=gon.address.state,d=gon.current_user.id;$.ajax({url:"/pedido",type:"POST",dataType:"json",data:{order:{freight_price:parseFloat($("input[name='tipoFrete']:checked").data("valor")),freight_type:$("input[name='tipoFrete']:checked").val(),status:"Processando",delivery_field1:e,delivery_field2:a,delivery_field3:n,delivery_field4:o,delivery_city:r,delivery_state:i,user_id:d}}}).done(function(e){console.log(e);var a=[],n=[],o=[];$(".nr").each(function(){a.push($(this).text())}),$(".p-qty").each(function(){n.push($(this).find("#p_quantity").val())}),$(".p-price").each(function(){o.push($(this).text())});for(var r=0;r<a.length;r++)$.ajax({url:"/produtos-pedidos",type:"POST",dataType:"json",data:{product_order:{name:a[r],price:o[r].replace("R$","").replace(",","."),quantity:n[r],order_id:e.id}}}).done(function(){console.log("success")}).fail(function(){console.log("error")});$.ajax({url:"/cartao-credito",type:"POST",dataType:"json",data:{credit_card:{card_number:$("input[name='credit_card_number']").val(),code:$("input[name='credit_card_code']").val(),client_name:$("input[name='credit_card_client_name']").val(),expiration:$("input[name='credit_card_year']").val()+$("input[name='credit_card_month']").val(),quota:$("#quota option:selected").val(),value:parseFloat(t)+parseFloat($("input[name='tipoFrete']:checked").data("valor")),client_id:gon.current_user.id}}}).done(function(){window.location.reload()}).fail(function(){window.location.reload()})}).fail(function(){console.log("error")})})}else window.location.reload("/usuarios"+gon.current_user.id+"/editar")});