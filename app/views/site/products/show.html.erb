<section class="product-details">
  <div class="row">
    <div class="col-sm-12">
      <ol class="breadcrumb">
        <li><%= link_to "Início", root_path %></li>
        <li><a href="#"><%= @product.category.name %></a></li>
        <li class="active"><%= @product.name %></li>
      </ol>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 col-sm-12">
      <%= image_tag(@product.cover.large, class: 'img-responsive img-rounded') %>
    </div>
    <div class="col-md-6 col-sm-12">
      <h1><%= @product.name %></h1>
      <br/>

      <p class="price"><%= number_to_currency(@product.price, unit: 'R$', separator: ",", delimiter: "") %></p>

      <div class="row">
        <div class="col-sm-12">
          <form class="form-horizontal" id="product_quantity">
            <div class="form-group">
              <label for="stock" class="col-sm-2 control-label">Quantidade</label>
              <div class="col-sm-2">
                <input type="number" class="form-control" id="p_stock" name="p_stock" min="1" max="<%= @product.stock %>" value="1">
              </div>
            </div>
          </form>
        </div>
      </div>

      <p><strong>Autor(es)</strong>: <%= @product.author %></p>
      <p><strong>Editora</strong>: <%= @product.publishing_house %></p>
      <p><strong>Páginas</strong>: <%= @product.number_pages %></p>
      <p><strong>Vendedor</strong>: <%= @product.user.firstname %> <%= @product.user.lastname %></p>
      <p class="text-right"><button class="btn btn-primary <% if !user_signed_in? %>disabled<% end %>" id="addToCart"><span class="fa fa-fw fa-cart-plus"></span> Adicionar ao carrinho</button></p>
      <p class="text-right"><a href="#"><span class="fa fa-fw fa-facebook"></span> Compartilhar no Facebook</a></p>
    </div>
  </div>
  <br/>

  <div class="row">
    <div class="col-sm-12">
      <div class="panel panel-default">
        <div class="panel-heading"><span class="fa fa-fw fa-info-circle"></span> Informações do produto</div>
        <div class="panel-body">
          <%= raw @product.description %>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      <div class="panel panel-default">
        <div class="panel-heading"><span class="fa fa-fw fa-comments"></span> Comentários</div>
        <div class="panel-body">
          <div id="disqus_thread"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<% if user_signed_in? %>
<script>
var productId = <%= @product.id %>;
var userId = <%= current_user.id %>;
$('#addToCart').on('click', function() {
var qty = document.getElementById('p_stock').value;
  $.ajax({
      url: '/carrinho',
      type: 'POST',
      dataType: 'json',
      data: {
        cart: {
          quantity: qty,
          product_id: productId,
          created_by: userId
        }
      },
    })
    .done(function(data) {
      alert(data.message);
    })
    .fail(function(data) {
      console.log("error");
    })
    .always(function() {
      console.log("complete");
    });
});
</script>
<% end %>
